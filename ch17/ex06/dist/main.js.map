{"version":3,"file":"main.js","mappings":"mBAAO,SAASA,EAAWC,EAAMC,EAAMC,EAAMC,EAAKC,GAChD,IAAK,IAAIC,EAAM,EAAGA,EAAMJ,EAAMI,IAC5B,IAAK,IAAIC,EAAM,EAAGA,EAAMJ,EAAMI,IAAO,CACnC,MAAMC,EAAOP,EAAKK,GAAKC,GACvBH,EAAIK,YACJL,EAAIM,KAAKH,EAAMF,EAAYC,EAAMD,EAAYA,EAAYA,GACzDD,EAAIO,UAAYH,EAAO,QAAU,QACjCJ,EAAIQ,OACJR,EAAIS,QACN,CAEF,MAAO,CAACZ,EAAMG,EAChB,CCTA,MAKMU,EAASC,SAASC,cAAc,WAChCZ,EAAMU,EAAOG,WAAW,MACxBC,EAAcH,SAASC,cAAc,UACrCG,EAAcJ,SAASC,cAAc,UAE3CF,EAAOM,MAAQlB,IACfY,EAAOO,OAASlB,IAGhB,IAAImB,EAAc,KAGlB,MAAMC,EAAQ,IAAIC,MAAM,kCAGxB,IAAIvB,EAAO,IAAIwB,MApBF,IAoBcb,KAAK,MAAMc,KAAI,IAAM,IAAID,MAnBvC,IAmBmDb,KAAK,MAAMc,KAAI,MAAQC,KAAKC,MAAsB,EAAhBD,KAAKE,cAGvGf,EAAOgB,iBAAiB,SAAS,SAAUC,GACzC,MAAMrB,EAAOI,EAAOkB,wBACdC,EAAUF,EAAIG,QAAUxB,EAAKyB,KAA7BF,EAAsCF,EAAIK,QAAU1B,EAAK2B,IAEzD/B,EAAMqB,KAAKC,MAAMK,EAxBN,IAyBX1B,EAAMoB,KAAKC,MAAMK,EAzBN,IA0BjBhC,EAAKK,GAAKC,IAAQN,EAAKK,GAAKC,GAC5BgB,EAAMe,YAAYC,OAClBvC,EAAWC,EA/BA,GACA,GA8BkBG,EA5BZ,GA6BnB,IAKA,IAAIoC,EAAe,EAEnB,SAASC,EAAOC,GACTF,IACHA,EAAeE,GAEDA,EAAYF,EALb,MAObA,EAAeE,EACfzC,EDnCG,SAAoBA,GAEzB,MAAM0C,EAAW1C,EAAKyB,KAAKkB,GAAQ,IAAIA,KACvC,IAAK,IAAItC,EAAM,EAAGA,ECgCQJ,GDhCII,IAC5B,IAAK,IAAIC,EAAM,EAAGA,EC+BYJ,GD/BAI,IAAO,CAYnC,IAAIsC,EAAa,EAVE,CACjB,EAAE,GAAI,GACN,EAAE,EAAG,GACL,EAAE,EAAG,GACL,CAAC,GAAI,GACL,CAAC,EAAG,GACJ,CAAC,GAAI,GACL,CAAC,EAAG,GACJ,CAAC,EAAG,IAGKC,SAASC,IAClB,MAAMd,EAAM,CAAC3B,EAAMyC,EAAK,GAAIxC,EAAMwC,EAAK,IAEnCd,EAAIe,OAAOC,GAAMA,GAAK,GAAKA,EAAI,OACjCJ,GAAc5C,EAAKgC,EAAI,IAAIA,EAAI,SASR,IAAvBU,EAASrC,GAAKC,GAEdoC,EAASrC,GAAKC,GADZsC,GAAc,GAAKA,GAAc,EAOnCF,EAASrC,GAAKC,GADG,IAAfsC,CAMR,CAEF,OAAOF,CACT,CCXWO,CAAWjD,GAClBD,EAAWC,EA/CF,GACA,GA8CoBG,EA5Cd,KA8CjBkB,EAAc6B,sBAAsBV,EACtC,CAEAvB,EAAYY,iBAAiB,SAAS,KAEhCR,GAGJmB,OAGFtB,EAAYW,iBAAiB,SAAS,KAE/BR,IAGL8B,qBAAqB9B,GACrBA,EAAc,SAGhBtB,EAAWC,EArEE,GACA,GAoEgBG,EAlEV,G","sources":["webpack://preset-ts/./ch17/ex06/util.js","webpack://preset-ts/./ch17/ex06/index.js"],"sourcesContent":["export function renderGrid(grid, ROWS, COLS, ctx, RESOLUTION) {\n  for (let row = 0; row < ROWS; row++) {\n    for (let col = 0; col < COLS; col++) {\n      const cell = grid[row][col];\n      ctx.beginPath();\n      ctx.rect(col * RESOLUTION, row * RESOLUTION, RESOLUTION, RESOLUTION);\n      ctx.fillStyle = cell ? 'black' : 'white';\n      ctx.fill();\n      ctx.stroke();\n    }\n  }\n  return [grid, ctx];\n}\n\nexport function updateGrid(grid, ROWS, COLS) {\n  // 新しいグリッドを作成\n  const nextGrid = grid.map((arr) => [...arr]);\n  for (let row = 0; row < ROWS; row++) {\n    for (let col = 0; col < COLS; col++) {\n      // 周囲のセルの生存数を数えて nextGrid[row][col] に true or false を設定する (実装してね)\n      const neighbours = [\n        [-1, -1],\n        [-1, 0],\n        [-1, 1],\n        [0, -1],\n        [0, 1],\n        [1, -1],\n        [1, 0],\n        [1, 1],\n      ];\n      let numOfAlive = 0;\n      neighbours.forEach((nPos) => {\n        const pos = [row + nPos[0], col + nPos[1]];\n        // 計算対象のセルがグリッドの中のものだけを計算対象にして生存数を加算\n        if (pos.every((e) => e >= 0 && e < 50)) {\n          numOfAlive += grid[pos[0]][pos[1]];\n        }\n      });\n      // 対象セルが生存の場合の周囲のセルの生存数\n      // * ２未満なら or ４以上なら false(dead)\n      // * ２、３なら true(alive)\n      // 対象セイルが死の場合の周囲のセルの生存数\n      // * ３なら true(alive)\n      // * ３以外なら false(dead)\n      if (nextGrid[row][col] === true) {\n        if (numOfAlive >= 2 && numOfAlive <= 3) {\n          nextGrid[row][col] = true;\n        } else {\n          nextGrid[row][col] = false;\n        }\n      } else {\n        if (numOfAlive === 3) {\n          nextGrid[row][col] = true;\n        } else {\n          nextGrid[row][col] = false;\n        }\n      }\n    }\n  }\n  return nextGrid;\n}\n","import {renderGrid, updateGrid} from './util.js';\n\n// 50 x 50 の盤面とする\nconst ROWS = 50;\nconst COLS = 50;\n// 1セルのサイズ\nconst RESOLUTION = 10;\n\nconst canvas = document.querySelector('#screen');\nconst ctx = canvas.getContext('2d');\nconst startButton = document.querySelector('#start');\nconst pauseButton = document.querySelector('#pause');\n\ncanvas.width = ROWS * RESOLUTION;\ncanvas.height = COLS * RESOLUTION;\n\n// https://developer.mozilla.org/ja/docs/Web/API/Window/requestAnimationFrame が返す ID\nlet animationId = null;\n\n// NOTE: download from https://soundeffect-lab.info/sound/button/mp3/decision1.mp3\nconst sound = new Audio('/ch15.04-10/ex10/decision1.mp3');\n\n// ライフゲームのセル (true or false) をランダムに初期化する\nlet grid = new Array(ROWS).fill(null).map(() => new Array(COLS).fill(null).map(() => !!Math.floor(Math.random() * 2)));\n\n// canvas がクリックされたときの処理 (セルの値を反転する)\ncanvas.addEventListener('click', function (evt) {\n  const rect = canvas.getBoundingClientRect();\n  const pos = {x: evt.clientX - rect.left, y: evt.clientY - rect.top};\n\n  const row = Math.floor(pos.y / RESOLUTION);\n  const col = Math.floor(pos.x / RESOLUTION);\n  grid[row][col] = !grid[row][col];\n  sound.cloneNode().play();\n  renderGrid(grid, ROWS, COLS, ctx, RESOLUTION);\n});\n\n// requestAnimationFrame によって一定間隔で更新・描画を行う\n// TODO: リフレッシュレートの高い画面では速く実行されてしまうため、以下を参考に更新頻度が常に一定となるようにしなさい\n// https://developer.mozilla.org/ja/docs/Web/API/Window/requestAnimationFrame\nlet previousTime = 0;\nconst interval = 100;\nfunction update(timestamp) {\n  if (!previousTime) {\n    previousTime = timestamp;\n  }\n  const elapsed = timestamp - previousTime;\n  if (elapsed > interval) {\n    previousTime = timestamp;\n    grid = updateGrid(grid, ROWS, COLS);\n    renderGrid(grid, ROWS, COLS, ctx, RESOLUTION);\n  }\n  animationId = requestAnimationFrame(update);\n}\n\nstartButton.addEventListener('click', () => {\n  // 既にアニメーションが動いている場合は何もしない\n  if (animationId) {\n    return;\n  }\n  update();\n});\n\npauseButton.addEventListener('click', () => {\n  // アニメーションが停止している場合は何もしない\n  if (!animationId) {\n    return;\n  }\n  cancelAnimationFrame(animationId);\n  animationId = null;\n});\n\nrenderGrid(grid, ROWS, COLS, ctx, RESOLUTION);\n"],"names":["renderGrid","grid","ROWS","COLS","ctx","RESOLUTION","row","col","cell","beginPath","rect","fillStyle","fill","stroke","canvas","document","querySelector","getContext","startButton","pauseButton","width","height","animationId","sound","Audio","Array","map","Math","floor","random","addEventListener","evt","getBoundingClientRect","pos","clientX","left","clientY","top","cloneNode","play","previousTime","update","timestamp","nextGrid","arr","numOfAlive","forEach","nPos","every","e","updateGrid","requestAnimationFrame","cancelAnimationFrame"],"sourceRoot":""}